<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Bot Dashboard</title>
</head>
<body>
    <h1>WhatsApp Bot Dashboard</h1>
    <div id="status">Loading...</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const adminPassword = prompt('Enter admin password:');

        function getAuthHeader() {
            return 'Basic ' + btoa(`admin:${adminPassword}`);
        }

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('status', (status) => {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `
                <p>WhatsApp Connected: ${status.whatsapp.isConnected}</p>
                <p>Bot Running: ${status.isRunning}</p>
            `;
        });

        async function getStatus() {
            try {
                const response = await fetch('/api/status', {
                    headers: {
                        'Authorization': getAuthHeader()
                    }
                });
                const status = await response.json();
                const statusDiv = document.getElementById('status');
                statusDiv.innerHTML = `
                    <p>WhatsApp Connected: ${status.whatsapp.isConnected}</p>
                    <p>Bot Running: ${status.isRunning}</p>
                `;
            } catch (error) {
                console.error('Error getting status:', error);
                const statusDiv = document.getElementById('status');
                statusDiv.innerHTML = 'Error getting status. Check the console for details.';
            }
        }

        if (adminPassword) {
            getStatus();
        }
    </script>
</body>
</html>